services:
  contract-tests:
    build:
      context: ..
      dockerfile: contract-tests/Dockerfile
    volumes:
      # Mount entire reference project (includes composer.json, vendor/, src/)
      - ..:/app
      # Named volume for vendor to persist between runs
      - contract-tests-vendor:/app/contract-tests/vendor
    working_dir: /app/contract-tests
    command: ["sh", "-c", "composer install --quiet && vendor/bin/phpunit --testdox"]

volumes:
  contract-tests-vendor:
